{# Jinja2 template for commands C header generation #}
/**
 * @file {{ name | lower | replace(' ', '_') }}.h
 * @brief Command definitions for {{ name }}
 *
 * This file is auto-generated by embgen. Do not edit manually.
 */

#ifndef {{ name | upper | replace(' ', '_') }}_H
#define {{ name | upper | replace(' ', '_') }}_H

#include <stdint.h>
#include <stddef.h>

/* ============================================================================
 * Command Map Configuration
 * ========================================================================== */

/** @brief Number of commands in the command map */
#define {{ name | upper | replace(' ', '_') }}_SIZE {{ commands|length }}

/* ============================================================================
 * Command IDs
 * ========================================================================== */

typedef enum {{ name | lower | replace(' ', '_') }}_command_id {
{% for command in commands %}
    {{ name | upper | replace(' ', '_') }}_CMD_{{ command.name | upper | replace(' ', '_') }} = {{ command.id }},{% if command.description %} /**< {{ command.description }} */{% endif %}

{% endfor %}
} {{ name | lower | replace(' ', '_') }}_command_id_t;

/* ============================================================================
 * Argument Enumerations
 * ========================================================================== */
{% for command in commands %}
{% for arg in command.args %}
{% if arg.enums %}

/** @brief Enumeration values for {{ command.name|upper }}.{{ arg.name }} argument */
typedef enum {{ name | lower | replace(' ', '_') }}_{{ command.name | lower | replace(' ', '_') }}_{{ arg.name | lower | replace(' ', '_') }} {
{% for enum in arg.enums %}
    {{ name | upper | replace(' ', '_') }}_{{ command.name | upper | replace(' ', '_') }}_{{ arg.name | upper | replace(' ', '_') }}_{{ enum.name | upper | replace(' ', '_') }} = {{ enum.value }},{% if enum.description %} /**< {{ enum.description }} */{% endif %}

{% endfor %}
} {{ name | lower | replace(' ', '_') }}_{{ command.name | lower | replace(' ', '_') }}_{{ arg.name | lower | replace(' ', '_') }}_t;
{% endif %}
{% endfor %}
{% endfor %}

/* ============================================================================
 * Command Argument Structures
 * ========================================================================== */
{% for command in commands %}

/**
 * @brief Arguments for {{ command.name|upper }} command (ID={{ command.id }})
{% if command.description %}
 * {{ command.description }}
{% endif %}
 */
typedef struct {{ name | lower | replace(' ', '_') }}_{{ command.name | lower | replace(' ', '_') }}_args {
{% if command.args %}
{% for arg in command.args %}
{% if arg.type == 'B' %}
    uint8_t {{ arg.name | lower | replace(' ', '_') }};{% if arg.description %} /**< {{ arg.description }} */{% endif %}

{% elif arg.type == 'H' %}
    uint16_t {{ arg.name | lower | replace(' ', '_') }};{% if arg.description %} /**< {{ arg.description }} */{% endif %}

{% elif arg.type == 'I' %}
    uint32_t {{ arg.name | lower | replace(' ', '_') }};{% if arg.description %} /**< {{ arg.description }} */{% endif %}

{% elif arg.type == 'Q' %}
    uint64_t {{ arg.name | lower | replace(' ', '_') }};{% if arg.description %} /**< {{ arg.description }} */{% endif %}

{% elif arg.type == 's' %}
    uint8_t *{{ arg.name | lower | replace(' ', '_') }};{% if arg.description %} /**< {{ arg.description }} */{% endif %}

    size_t {{ arg.name | lower | replace(' ', '_') }}_len; /**< Length of {{ arg.name | lower }} data */
{% else %}
    uint8_t {{ arg.name | lower | replace(' ', '_') }};{% if arg.description %} /**< {{ arg.description }} */{% endif %}

{% endif %}
{% endfor %}
{% else %}
    uint8_t _reserved; /**< Placeholder for empty struct */
{% endif %}
} {{ name | lower | replace(' ', '_') }}_{{ command.name | lower | replace(' ', '_') }}_args_t;
{% endfor %}

/* ============================================================================
 * Command Structure Definitions
 * ========================================================================== */

/**
 * @brief Union of all command argument structures
 */
typedef union {{ name | lower | replace(' ', '_') }}_command_args {
{% for command in commands %}
    {{ name | lower | replace(' ', '_') }}_{{ command.name | lower | replace(' ', '_') }}_args_t {{ command.name | lower | replace(' ', '_') }}; /**< Arguments for {{ command.name|upper }} command */
{% endfor %}
} {{ name | lower | replace(' ', '_') }}_command_args_t;

/**
 * @brief Structure representing a command
 */
typedef struct {{ name | lower | replace(' ', '_') }}_command {
    {{ name | lower | replace(' ', '_') }}_command_id_t id; /**< Command ID */
    uint16_t arg_count; /**< Number of arguments */
    {{ name | lower | replace(' ', '_') }}_command_args_t *args; /**< Command arguments */
    const char *name; /**< Command name */
    const char *description; /**< Command description */
} {{ name | lower | replace(' ', '_') }}_command_t;

/* ============================================================================
 * Command Default Values
 * ========================================================================== */
{% for command in commands %}
{% for arg in command.args %}
{% if arg.default is defined and arg.default != None %}
#define {{ name | upper | replace(' ', '_') }}_{{ command.name | upper | replace(' ', '_') }}_{{ arg.name | upper | replace(' ', '_') }}_DEFAULT {{ arg.default if arg.default is not sameas true and arg.default is not sameas false else (1 if arg.default else 0) }}
{% endif %}
{% endfor %}
{% endfor %}

/* ============================================================================
 * Command Argument Counts
 * ========================================================================== */

static const uint16_t {{ name | upper | replace(' ', '_') }}_ARG_COUNTS[{{ name | upper | replace(' ', '_') }}_SIZE] = {
{% for command in commands %}
    [{{ name | upper | replace(' ', '_') }}_CMD_{{ command.name | upper | replace(' ', '_') }}] = {{ command.args|length }},
{% endfor %}
};


/* ============================================================================
 * Command Descriptions
 * ========================================================================== */

static const char *{{ name | upper | replace(' ', '_') }}_DESCRIPTIONS[{{ name | upper | replace(' ', '_') }}_SIZE] = {
{% for command in commands %}
    [{{ name | upper | replace(' ', '_') }}_CMD_{{ command.name | upper | replace(' ', '_') }}] = "{{ command.description or 'No description' }}",
{% endfor %}
};

/* ============================================================================
 * Command Names
 * ========================================================================== */

static const char *{{ name | upper | replace(' ', '_') }}_NAMES[{{ name | upper | replace(' ', '_') }}_SIZE] = {
{% for command in commands %}
    [{{ name | upper | replace(' ', '_') }}_CMD_{{ command.name | upper | replace(' ', '_') }}] = "{{ command.name | upper }}",
{% endfor %}
};

/* ============================================================================
 * Default Initialization Macros
 * ========================================================================== */
{% for command in commands %}
{% if command.args %}

/** @brief Initialize {{ command.name|upper }} arguments with default values */
#define {{ name | upper | replace(' ', '_') }}_{{ command.name | upper | replace(' ', '_') }}_ARGS_INIT { {% for arg in command.args %}.{{ arg.name | lower | replace(' ', '_') }} = {% if arg.default is defined and arg.default != None %}{{ arg.default if arg.default is not sameas true and arg.default is not sameas false else (1 if arg.default else 0) }}{% else %}0{% endif %}{% if not loop.last %}, {% endif %}{% endfor %} }
{% endif %}
{% endfor %}

#endif /* {{ name | upper | replace(' ', '_') }}_H */
