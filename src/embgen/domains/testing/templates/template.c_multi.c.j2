{# Multi-file template: Source file (.c) #}
{# Part of c_multi group - generates .h and .c files #}
/**
 * @file {{ output_filename }}.c
 * @brief {{ name }} - Auto-generated source
 * @version {{ version }}
 * @date {{ generated_on }}
 *
 * This file was generated by embgen testing domain.
 * DO NOT EDIT MANUALLY.
 */

#include "{{ output_filename }}.h"
#include <string.h>

/*============================================================================*/
/* Global Data Definitions                                                    */
/*============================================================================*/

const {{ name }}_Item {{ name | lower }}_items[{{ name | upper }}_ITEM_COUNT] = {
{% for item in items %}
    {
        .name = "{{ item.name }}",
        .type = {{ name | upper }}_TYPE_{{ item.item_type | upper }},
        .value = {{ item.value }},
        .enabled = {{ "true" if item.enabled else "false" }},
        .description = {% if item.description %}"{{ item.description }}"{% else %}NULL{% endif %},
        .tag_count = {{ item.tag_count }},
    },
{% endfor %}
};

{% if global_tags %}
const {{ name }}_Tag {{ name | lower }}_global_tags[{{ name | upper }}_GLOBAL_TAG_COUNT] = {
{% for tag in global_tags %}
    {
        .name = "{{ tag.name }}",
        .value = {{ tag.value | default(0) }},
        .has_value = {{ "true" if tag.value is not none else "false" }},
    },
{% endfor %}
};
{% else %}
const {{ name }}_Tag {{ name | lower }}_global_tags[1] = {
    { .name = NULL, .value = 0, .has_value = false }
};
{% endif %}

/*============================================================================*/
/* Function Definitions                                                       */
/*============================================================================*/

const {{ name }}_Item* {{ name | lower }}_get_item(uint32_t index)
{
    if (index >= {{ name | upper }}_ITEM_COUNT) {
        return NULL;
    }
    return &{{ name | lower }}_items[index];
}

const {{ name }}_Item* {{ name | lower }}_find_item(const char* name)
{
    if (name == NULL) {
        return NULL;
    }
    for (uint32_t i = 0; i < {{ name | upper }}_ITEM_COUNT; i++) {
        if (strcmp({{ name | lower }}_items[i].name, name) == 0) {
            return &{{ name | lower }}_items[i];
        }
    }
    return NULL;
}

uint32_t {{ name | lower }}_get_enabled_count(void)
{
    uint32_t count = 0;
    for (uint32_t i = 0; i < {{ name | upper }}_ITEM_COUNT; i++) {
        if ({{ name | lower }}_items[i].enabled) {
            count++;
        }
    }
    return count;
}

/*============================================================================*/
/* Debug Information                                                          */
/*============================================================================*/

#ifdef DEBUG
#include <stdio.h>

void {{ name | lower }}_print_summary(void)
{
    printf("{{ name }} v{{ version }}\n");
    printf("Total items: %u\n", {{ name | upper }}_ITEM_COUNT);
    printf("Enabled items: %u\n", {{ name | lower }}_get_enabled_count());
    printf("Global tags: %u\n", {{ name | upper }}_GLOBAL_TAG_COUNT);
}

void {{ name | lower }}_print_items(void)
{
    for (uint32_t i = 0; i < {{ name | upper }}_ITEM_COUNT; i++) {
        const {{ name }}_Item* item = &{{ name | lower }}_items[i];
        printf("[%u] %s: type=%d value=%d enabled=%s\n",
               i, item->name, item->type, item->value,
               item->enabled ? "yes" : "no");
    }
}
#endif /* DEBUG */
